## HTTPS
HTTP에서 SSL을 사용한 프로토콜, SSL은 서버와 브라우저 사이에 안전하게 암호화된 연결을 만들 수 있게 도와주고, 
서버와 브라우저가 민감한 정보를 주고받을 때 해당 정보가 도난당하는 것을 막아준다.  

HTTP 헤더는 암호화 되지 않고, HTTP 메시지 바디를 암호화하는 것이다.  
<br/>

### SSL/TLS
웹 서버와 웹 브라우저간의 보안을 위해 만든 프로토콜  
공개키/개인키, 대칭키 기반으로 사용함  

> SSL가 업그레이드 되어서 TLS라는 명칭으로 바뀐것이고, 엄밀히 따지면 다른 것이지만, 
> 의미상으로는 같다고 보면된다.

<br/>

### TLS Handshake
TLS 1.3에서는 암호화 방식을 각각 합의한다. 그리고 키 교환 방식도 ECDHE 혹은 DH만을 지원한다. 따라서 
클라이언트는 시작할 때부터 "ClientHello"를 보낼 때 지원하는 키 교환 방식에 해당하는 모든 방법을 
TLS 핸드셰이크 확장기능인 "key-share"와 함께 보낸다.  

![image](https://github.com/hong-gp/study/assets/127091213/130054d2-b6b1-473e-aafb-9afa7d2b01c1)

클라이언트가 데이터를 보낼때, 사이퍼 슈트도 전달한다. 서버는 전달받은 사이퍼 슈트의 리스트에서 
호환되는 알고리즘을 선택하고 사용하여 통신이 수행된다.  
<br/>

### 사이퍼 슈트(Cipher Suite)
암호화 협상을 위한 알고리즘을 무엇을 쓸 것인지 나열한 것  

![image](https://github.com/hong-gp/study/assets/127091213/e6ecc7d2-8110-4b7a-83c9-09683f67962e)  

`Bulk Encryption Algorithm`은 AEAD Cipher를 나타내며, 이는 데이터 암호화 알고리즘이다.  

<br/>

### 암호화 알고리즘
암호화 알고리즘에는 대칭키와 공개키(비대칭키)라는 두 가지 유형의 알고리즘이 있다.  

#### 대칭키
동일한 키로 암호화, 복호화를 수행하는 방법  

- 누구든지 암호화에 이용된 키를 가지고 있으면 해당 데이터를 쉽게 복호화 할 수 있다.
- 키를 배송할 때 보안 문제가 있음.

<br/>

#### 공개키
서로 다른 키로 암호화, 복호화를 하는 방법 (비대칭키)  
데이터 암호화시에는 공개키를 사용하고, 복호화시에는 개인키를 사용한다.  

- 개인키를 가지고 복호화를 하기때문에 공개키를 누구나 가져도 쉽게 복호화할 수 없다.
- 암호화 연산 시간이 대칭키보다 더 소요되기 때문에 비용이 크다.

<br/>

TLS는 대칭키와 공개키를 키 교환 알고리즘을 통해 적절히 혼합하여 사용한다.  

### 키 교환 알고리즘
키 교환 알고리즘은 Diffie-Hellman Ephemeral(DHE), Diffi Curve Diffie-Hellman Ephermeral(ECDHE)를 사용한다.  
둘 다 Diffie-Hellman 방식을 근간으로 만들어졌다. 

![image](https://github.com/hong-gp/study/assets/127091213/0bc75e80-7bc5-45fb-8b60-54310bf99555)

처음에 공개 값을 공유하고 각자의 비밀 값과 혼합한 후 혼합 값을 공유한다. 
그 다음 각자의 비밀 값과 다시 혼합해서 공통의 암호키인 PSK가 생성된다.  

<br/>

### TLS 통신 과정
TLS은 공개키 방식으로 대칭키를 전달하고, 대칭키를 활용해서 암호화, 복호화를 하고 서버와 브라우저가 통신한다.

1. A가 B에게 접속 요청
2. B가 A에게 자신의 공개키를 전송
3. A는 자신의 대칭키를 B에게 받은 공개키로 암호화하고 B에게 전송한다.
4. B는 암호화된 대칭키를 자신의 개인키로 복호화해서 A의 대칭키를 얻어낸다.
5. 이렇게 얻은 대칭키를 통해서 A와 B는 서로 안전하게 통신할 수 있다.  

<br/>

### CA 발급 과정
인증 메커니즘은 CA(Certificate Authorities)에서 발급한 인증서를 기반으로 이루어진다. 
CA에서 발급한 인증서는 안전한 연결을 시작하는 데 있어 필요한 공개키를 클라이언트에게 제공하고 
사용자가 접속한 서버가 신뢰할 수 있는 서버임을 보장한다.  

1. 사이트는 사이트 인증서가 필요하다. 사이트에서 인증기관에게 사이트 정보과 공개키를 전달한다. 
2. 인증기관은 전달받은 데이터를 검증해서 인증기관의 개인키로 서명해서 사이트 인증서를 사이트에게 전달한다.
3. 인증기관은 사용자에게 자신의 공개키를 전달한다.
4. 사용자가 인증기관에게 전달받은 공개키는 사용자 브라우저에 내장된다. 
5. 사용자가 사이트에 접속 요청하면 사이트는 사이트 인증서를 사용자에게 전달한다. 
6. 사용자는 브라우저에 내장되어있는 인증기관 공개키를 이용해서 사이트 인증서를 복호화한다. 
7. 사이트 정보와 사이트 공개키를 얻어내고, 사이트 공개키로 사용자 대칭키를 암호화 한다. 
8. 암호화한 대칭키를 사이트에게 전달하면 사이트의 개인키로 해독해서 대칭키를 얻어낸다.
9. 이 대칭키를 통해 SSL 통신을 할 수 있다.

<br/>

### 해싱 알고리즘
원본 데이터마다 일정한 결과값을 도출하며 원본 데이터가 변경되면 결과값 또한 달라지는 특성을 지닌 알고리즘  
해싱 알고리즘 중 하나인 SHA-256 알고리즘을 통해 알아보자.  

SHA-256 알고리즘을 평문에 적용했을 때 알아보기 어려운 해시값이 나타나는 것을 볼 수 있다.  

|INPUT|OUTPUT|
|-----|-----|
|객체지향의 사실과 오해|46d2fbf8a0bdfc39e3c2f84941c61086ab588bdf9e9fed90c33a97f7efa7092a|  

송신자는 원본 데이터와 해시 알고리즘이 적용된 데이터를 함께 전송하고 수신자는 약속한 해시 알고리즘을 이용해 
원본 데이터에 적용해 본다. 그 결과가 같다면 변조되지 않은 값이라는 것을 알 수 있다.  

<br/>

### SEO(Search Engine Oprimization)
구글에서는 SSL을 사용하는 사이트의 SEO 순위가 높을 것이라고 공식적으로 밝혔다.  
SEO는 검색엔진 최적화를 뜻하며 웹 사이트가 검색 결과에 더 잘 보이도록 최적화하는 과정이다.  

검색 엔진은 웹을 크롤링하면서 일정 규칙을 따르며, 해당 규칙을 밀접하게 따라가면 웹 사이트가 
검색 결과 최상위에 노출될 가능성이 높아진다.  

이를 위한 방법으로 캐노니컬 태그, 메타 설정, 페이지 속도 개선, 사이트맵 관리 등의 방법이 있다.  

#### 캐노니컬 태그
캐노니컬 태그는 한 페이지를 가리키는 여러 개의 주소가 존재할 때, 
검색 엔진이 어떤 주소가 원본인지 알 수 있도록 사용하는 태그다.  

#### 메타 설정
메타 태그는 웹 페이지에 대한 정보를 제공하는 기능을 하고 있다. 이러한 정보를 메타데이러하고 하고 
검색엔진이나 웹 크롤러를 통해 수집된다.  

검색 엔진은 획득한 메타 데이터를 통해 페이지의 랭킹을 매기는 데 사용할 수 있고, 검색 결과를 나타내는데 사용할 수 있다.  

#### 페이지 속도 개선
페이지의 속토가 빠르면 검색 엔진은 해당 사이트의 순위를 올려준다.  

#### 사이트맵
검색 엔진에게 페이지의 구조를 알려주는 것으로 많은 콘텐츠를 담은 페이지를 상위 랭크로 올릴 수 있다.  

### HTTPS 구축 방법
- 직접 CA에서 구매한 인증키를 기반으로 구축
- 서버 앞단에 HTTPS를 제공하는 로드밸런서를 둔다.
- 서버 앞단에 HTTPS를 제공하는 CDN을 둔다.

<br/>

---
### 참고
- https://www.youtube.com/watch?v=wPdH7lJ8jf0
- https://sectigostore.com/blog/what-is-an-ssl-tls-cipher-suite/
- https://aws-hyoh.tistory.com/47
