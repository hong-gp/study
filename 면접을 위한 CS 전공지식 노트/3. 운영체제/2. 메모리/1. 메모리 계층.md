## 메모리 계층 (Memory Hierarchy)
![image](https://github.com/hong-gp/study/assets/127091213/9ca85095-09f7-4b11-ae8a-3b29c0abda62)  

> L1 Cache : 프로세서와 가장 가까운 캐시  
> L2 Cache : 용량이 큰 캐시  
> L3 Cache : 멀티 코어 시스템에서 여러 코어가 공유하는 캐시  

위로 갈수록 빨라지고 비싸지며 용량은 적어진다.  

메모리 계층 구조는 데이터 병목 현상을 해결하기 위해 생겼다. 기술의 발전으로 CPU의 속도는 빠른 속도로 발전한 반면, 
메모리의 CPU의 속도를 따라가지 못했다. CPU가 아무리 빨라도 메모리의 처리 속도가 느리면 전체 시스템의 속도는 느려진다.  
메모리 접근 속도를 높여서 전체적인 프로그램의 속도를 향상시키는 것이 메모리 계층 구조다.  

캐시 메모리나 주기억장치의 용량을 늘리는 것은 비용적인 문제가 있다.  

RAM과 주로 자료를 주고 받는다고 할 때, CPU에게는 RAM이 느리게 느껴진다. 
그래서 CPU는 자주 쓰는 데이터들을 캐시 메모리에 넣어서 사용한다.  

프로그램이 산발적이라면 계층 구조가 더 부담스러울 것이다. 지역성이라는 특징때문에 계층 구조의 성능이 좋아진다.  

<br/>

## Locality (지역성)
- CPU가 기억장치의 특정 부분에 위치한 데이터나 프로그램 코드를 집중적으로 엑세스하는 현상
- 고비용/고속 저장장치의 효율적 사용 및 속도 향상 가능

![image](https://github.com/hong-gp/study/assets/127091213/6fe7a1d8-f892-493e-ba39-0c2726cafc9b)

<br/>

```java
for (int i = 0; i < 10; i++) {
    arr[i] = i;
}
```  

### Temporal Locality (시간적 지역성)
- 최근 사용된 데이터는 가까운 미래에 다시 액세스할 가능성이 높다.
- 변수 `i`는 짧은 시간안에 여러번 접근이 이뤄진다.

<br/>

### Spatial Locality (공간적 지역성) 
- 최근 사용된 데이터가 있는 기억공간에 접근할 가능성이 높다.
- 배열 `arr`의 각 요소를 참조하면서 가까운 공간에 연속적으로 접근하고 있다.

<br/>

## 캐시 메모리
CPU와 메모리 사이에 위치한 레지스터보다 용량이 크고 메모리보다 빠른 SRAM 기반의 저장 장치.  
CPU가 메모리에 접근하는건 오래 걸리니 캐시 메모리를 둬서 쓰자.  

### 캐시 히트
CPU에서 요청한 데이터가 캐시에 존재하는 경우

### 캐시 미스
CPU에서 요청한 데이터가 캐시에 존재하지 않는 경우

<br/>

캐시 히트 시 CPU 내부에 있거나 매우 가까운 곳에 있기 때문에 CPU 내부 버스 기반으로 작동해 빠르고, 
캐시 미스는 메모리까지 접근하기 떄문에 시스템 버스를 기반으로 작동해 느리다.  

- 시스템 버스 : 메모리와 주변장치를 연결하는 버스
- CPU 내부 버스 : CPU 내부에 있는 장치를 연결하는 버

> 캐시 적중률 = 캐시 히트 횟수 / (캐시 히트 횟수 + 캐시 미스 횟수)  
> 캐시 적중률은 보통 90%이상이다. 

<br/>

## 캐시 매핑
### 직접 사상 방식
메인 메모리 주소로부터 Tag, Line, Work 정보를 받아와 캐시 메모리내에 저장될 위치를 결정하는 방식.  

Tag는 메인 메모리에서 어떤 주소에서 가져왔는지를 구분하기 위한 정보
Line은 캐시 메모리 내에 몇번째 라인에 저장할지를 구분하기 위한 정보
Work는 사용할 데이터 조각이 담기는 공간이다.

<br/>

---
### 참고
- https://www.youtube.com/watch?v=QRww8UX07jw
- https://blog.skby.net/%EC%A7%80%EC%97%AD%EC%84%B1-locality/
- https://parksb.github.io/article/29.html
- https://sujinhope.github.io/2020/03/13/%EC%BB%B4%ED%93%A8%ED%84%B0%EC%9D%98-%EB%A9%94%EB%AA%A8%EB%A6%AC%EA%B5%AC%EC%A1%B0-%EC%BA%90%EC%8B%9C,%EB%A9%94%EB%AA%A8%EB%A6%AC,%EB%94%94%EC%8A%A4%ED%81%AC%EC%9D%98-%EC%B0%A8%EC%9D%B4.html
- https://code-piggy.tistory.com/entry/%EB%A0%88%EC%A7%80%EC%8A%A4%ED%84%B0-%EA%B0%80%EC%83%81%EB%A9%94%EB%AA%A8%EB%A6%AC
- https://www.youtube.com/watch?v=qLCP0PwRp_w
- https://star7sss.tistory.com/930
